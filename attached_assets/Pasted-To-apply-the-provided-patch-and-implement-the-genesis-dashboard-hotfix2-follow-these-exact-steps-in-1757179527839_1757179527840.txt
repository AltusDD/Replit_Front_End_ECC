To apply the provided patch and implement the genesis-dashboard-hotfix2, follow these exact steps in your Replit shell:

✅ Step-by-Step Patch Instructions:

Create the Patch File

Save the content of the patch you posted as a file named:

genesis-dashboard-hotfix2.patch


in the root directory of your Replit project.

Create a New Branch

Run:

git checkout -b fix/genesis-dashboard-hotfix2


Apply the Patch

Run:

git apply --whitespace=fix genesis-dashboard-hotfix2.patch


If any hunk fails, manually make the replacements as indicated in the diff.

Install Required Packages

Run:

npm i @vis.gl/react-google-maps @googlemaps/markerclusterer recharts


Commit the Changes

Run:

git commit -am "Dashboard: live-only data, endpoint autodetection, unit-based occupancy, abort safety, map precision"

🧪 Optional Verification (Shell Commands)

You can validate that the patch was applied correctly using these commands:

# No mock/random anywhere
rg -n "Math\.random|faker|mock" src | rg -v "node_modules" || echo "OK: no mock/random found"

# Hook loads, swallows AbortError, and tries endpoint variants
rg -n "fetchFirstAvailable|isAbortError" src/features/dashboard/hooks/useDashboardData.ts

# Collections MTD drawn only from live txns (or '—' if none)
rg -n "Collections MTD" src/features/dashboard/hooks/useDashboardData.ts

# Occupancy derived from Units (+ Leases) not Properties
rg -n "normalizeUnitStatus|indexLeasesByUnit|occupiedUnits" src/features/dashboard/hooks/useDashboardData.ts

# City occupancy aggregation from Units
rg -n "aggregateOccByCityFromUnits" src/features/dashboard/hooks/useDashboardData.ts

# No coordinate jitter, precise map
rg -n "Math\.random|jitter" src/features/dashboard/components/PortfolioGoogleMap.tsx || echo "OK: no jitter"

🌐 Enable Map Display (Google Maps)

To activate the map view:

echo 'VITE_GOOGLE_MAPS_API_KEY=YOUR_KEY_HERE' >> .env


Replace YOUR_KEY_HERE with your actual Google Maps API key.

Let me know if you want help pasting or applying the patch file in your Replit environment.