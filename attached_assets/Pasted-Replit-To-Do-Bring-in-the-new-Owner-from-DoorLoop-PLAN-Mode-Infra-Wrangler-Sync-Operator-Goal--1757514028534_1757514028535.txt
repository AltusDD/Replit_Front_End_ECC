Replit To-Do — Bring in the new Owner from DoorLoop

PLAN
Mode: Infra Wrangler + Sync Operator
Goal: Confirm the scheduler is on; force an incremental sync for owners,properties; verify data landed.

CHECK 1 — Env flags are present

Open Secrets and confirm:
- DOORLOOP_API_KEY = *****
- ADMIN_SYNC_TOKEN = *****
- AUTO_SYNC_ENABLED = true
- AUTO_SYNC_INTERVAL_MINUTES = 10
- SYNC_ENTITIES = owners,properties,units,leases,tenants
- (optional) AUTO_SYNC_FULL_AT_HOUR_UTC = 5


If any are missing, add them and restart the app.

CHECK 2 — Is the background scheduler running?

Open server logs and confirm lines from server/lib/sync/auto.ts like:

“AUTO_SYNC: acquired scheduler lock”

“AUTO_SYNC: next run in 10m”
If not present, restart the server.

RUN — Manual incremental sync (owners + properties)
Use the admin UI:

Visit /admin/sync

Select incremental

Check only owners and properties

Click Run Sync

Or call the admin API directly:

POST /api/admin/sync
Authorization: Bearer {ADMIN_SYNC_TOKEN}
Content-Type: application/json

{ "mode": "incremental", "entities": ["owners","properties"] }


VERIFY — Did it land?
Open your browser dev tools Network tab or use these checks:

Integration state marker

Visit /api/integration-state (or check the AdminSync page output) and confirm updated cursors for owners/properties.

Owners exist

Hit /api/entities/owners?limit=5 and look for the new owner in the payload.

Or check one directly: /api/entities/owners/{newOwnerId} (should return 200 with data).

Properties reflect new owner (optional)

Spot-check one: /api/entities/properties/{id} → owner_id should match.

Audit trail

Visit /api/audit/recent?limit=50 and look for events labeled AUTO_SYNC or ADMIN_SYNC.

FOLLOW-UP — Owner Transfer flow

Open /owners/transfer?ownerId={newOwnerId}

Proceed with Approve Accounting → Authorize → Execute Now (admin-gated).
(Buttons are on Transfer Detail; ensure you’re signed in with admin token for the admin actions.)

IF STILL MISSING — Run a one-time full owners refresh
This is heavier but safe:

POST /api/admin/sync
Authorization: Bearer {ADMIN_SYNC_TOKEN}
Content-Type: application/json

{ "mode": "full", "entities": ["owners","properties"] }


Then repeat the VERIFY steps.

Quick triage notes (only if something looks off)

401 on admin sync → ADMIN_SYNC_TOKEN is wrong or missing in request.

404 on entity GET → wrong ID; list owners first at /api/entities/owners?limit=50.

DoorLoop key issues → you’ll see 401/403 from DoorLoop in logs; re-check DOORLOOP_API_KEY.

Scheduler not running → ensure AUTO_SYNC_ENABLED=true, then restart; logs should print the lock acquisition.

No geocodes → The auto-geocode tick backfills coordinates over time; it writes GEOCODE_AUTO events to audit_events.