REPLIT CHAT PROMPT — “Genesis Dashboard v2 (Live-Only, Actionable, Polished)”

Mode: Audit → Plan → Small atomic PRs → Verify.
Absolutely non-negotiable guardrails:

No mock or fixture data anywhere. If the dashboard imports anything with names like mock, fixture, seed, example, or faker, stop and report. All data must come from the same live sources used by Portfolio V3.

Keep routes, filenames, and existing Portfolio pages unchanged. Do not regress working pages.

Replace any brown tint backgrounds with our approved neutral panel color.

Global date format: Mon D, YYYY (e.g., Sep 7, 2025).

Dashboard must be zippy and silent (no console errors/warnings, skeleton loaders for all async areas, AbortController on fetch).

Phase 0 — Preflight Audit (read-only; paste findings)

List current dashboard files and imports:

src/features/dashboard/pages/DashboardPage.tsx

src/features/dashboard/components/*

src/features/dashboard/hooks/*

List all data sources (Supabase/REST) currently used by the dashboard and by Portfolio pages (properties, units, leases, tenants, charges/payments/ledger, work_orders).

Grep for mock/fixture/seed references anywhere in dashboard code. If any are referenced, paste the exact import lines and file paths.

Phase 1 — Theme & Formatting Corrections (no brown tint; consistent dates)

1. Tokens / colors
Add or ensure these tokens (or update existing) so all panels/cards use the neutral grey—not brown:

/* src/styles/tokens.css (or global) */
:root{
  --altus-black:#0b0e12;
  --altus-gold:#d6b36a;

  /* Approved neutrals */
  --panel-bg:#1a1d21;    /* card/panel background */
  --panel-elev:#20242a;  /* elevated surface */
  --line:#2a2d31;

  --text:#e6e7ea;
  --text-dim:#a8adb7;

  --good:#31c48d;   /* green */
  --warn:#f3c969;   /* yellow */
  --bad:#ef5953;    /* red */
  --neutral:#7b818a;
}


Update all dashboard panels to use --panel-bg and borders --line. Remove any brown backgrounds.

2. Format helpers
Create/ensure src/utils/format.ts and update dashboard to use only these:

export const fmtDate = (iso?: string|null) =>
  !iso ? "—" : new Date(iso).toLocaleDateString(undefined,{month:"short",day:"numeric",year:"numeric"});

export const fmtMoney = (n?: number|null) =>
  n==null||Number.isNaN(n) ? "—" : n===0 ? "$0" :
  n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:2});

export const fmtPct = (v?: number|null, d=1) =>
  v==null ? "—" : `${v.toFixed(d)}%`;

export const plural = (n:number, s:string) => `${n} ${n===1?s:`${s}s`}`;


AC: No brown tints remain; every date on the dashboard renders as Mon D, YYYY.

Phase 2 — Live API Hooks (replace any mock paths)

Create/replace live-only hooks in src/features/dashboard/hooks/useDashboardData.ts with AbortController, types, and memoization. Use the same tables/joins already powering Portfolio V3:

Return this shape (all arrays typed, never undefined; empty states allowed):

kpis

occupancyPct: occupiedUnits/totalUnits

rentReadyVacant: { ready:number, vacant:number }

collectionsRatePct (MTD): paidThisMonth / billedThisMonth

openCriticalWO: count of work_orders where priority in (“High”,”Critical”) and status not closed

noiMTD: income MTD − expenses MTD

propertiesForMap: { id, lat, lng, address, city, state, status, delinquent:boolean, rentReady:boolean, currentTenant?:string }[]

cashflow90: last 90 days buckets { periodLabel, income, expenses, noi }[]

funnel30: { leads, tours, applications, signed }

occByCity: { city, properties, occUnits, vacUnits, occPct }[]

actionFeed:

delinquentsTop: top 3 { tenantId, tenant, property, balance, daysOverdue }

leasesExpiring45: { leaseId, tenant, property, endDate, daysToEnd }

workOrdersHotlist: { woId, property, summary, priority, ageDays }

Use the same field names and id normalization already used in Portfolio pages. Add ?debug=1 support: when present, log dataset sizes and any empty series (but never throw).

Phase 3 — Fix & Finish Widgets (actionable + polished)
3.1 KPI Ticker (top row)

File: src/features/dashboard/components/KpiTicker.tsx

Four KPIs with small donut/sparkline and trend badges; each is clickable:

Occupancy fmtPct(occupancyPct) → route /portfolio/units?status=occupied

Rent-Ready / Vacant ready / vacant → /portfolio/units?status=vacant

Collections (MTD) fmtPct(collectionsRatePct) → /accounting?scope=mtd&filter=unpaid

Critical WOs openCriticalWO → /construction?priority=high

Use tokens: green for positive, red for negative trend.

3.2 Operations Map (centerpiece)

File: src/features/dashboard/components/PortfolioGoogleMap.tsx

Use @vis.gl/react-google-maps. Require VITE_GOOGLE_MAPS_API_KEY. If missing, show friendly inline empty state.

Custom house SVG pins with dynamic color:

Green: occupied & current

Yellow: vacant & rent-ready

Orange: vacant & not rent-ready

Red: occupied & delinquent

Clustering with @googlemaps/markerclusterer.

Custom InfoWindow: address, badges (Vacant/Delinquent/Rent-Ready), current tenant, and 3 actions:

View Property → /portfolio/properties?focus={id}

Open Work Orders → /construction?property={id}

Open Ledger → /accounting?property={id}

3.3 Priority Action Feed (right of map)

File: src/features/dashboard/components/PriorityActionFeed.tsx

Three grouped sections (max 3 each) with ActionButtons:

🆘 Delinquency Alerts: “Send Reminder”, “Start Eviction” (link to comms/legal routes)

⚠️ Lease Renewals (≤45d): “Prepare Renewal”, “Do Not Renew”

🛠️ Maintenance Hotlist: “Assign Vendor”

Each item shows tenant/property, amount/days, and dates in Mon D, YYYY. When a section has no items, show a positive empty state (“No delinquent tenants. 🎉”).

3.4 Cashflow + Leasing (row below)

File: src/features/dashboard/components/FinancialsAndLeasing.tsx

Cash Flow (90d): Recharts combo chart: Income (green bars), Expenses (neutral bars), NOI (gold line). Toggle: 30/60/90 days. Tooltips use fmtMoney.

Leasing Funnel (30d): Horizontal funnel Leads → Tours → Apps → Signed, with counts and per-step conversion percentages beneath.

3.5 Occupancy by City (table polish)

File: src/features/dashboard/components/OccupancyByCity.tsx (create if missing)

Columns: City, # Properties, Occ Units, Vac Units, Occ %.

Right-align numerics; Occ % uses a thin gold progress bar (no brown).

Sortable by Occ % descending.

3.6 Reusable Shells

ChartContainer.tsx: title, range dropdown, overflow menu (Export CSV/PNG), body slot; panel uses --panel-bg.

ActionButton.tsx: primary (gold) & secondary (outline); keyboard/focus states; small/medium sizes.

All async panels show skeleton loaders (no popping layout).

Phase 4 — Layout & Spacing

File: src/features/dashboard/pages/DashboardPage.tsx

Responsive CSS grid:

Row 1: KpiTicker (full width)

Row 2: PortfolioGoogleMap (2/3) | PriorityActionFeed (1/3)

Row 3: FinancialsAndLeasing (two equal columns)

Row 4: OccupancyByCity (full width)

Use generous spacing, sticky section headers on scroll, and subtle shadows (box-shadow: 0 4px 16px rgba(0,0,0,.25)).

Phase 5 — Performance & Stability

All hooks: AbortController cleanup in useEffect.

Heavy joins & derived stats computed in one place (the hook) and memoized.

Charts render only after data is ready; otherwise show skeleton.

No console warnings/errors. Fix any DOMException/Abort spam.

Add a debug banner only when ?debug=1: show record counts (units/properties/leases), billed/paid MTD, # critical WOs, funnel counts.

Phase 6 — Acceptance Criteria (paste proof)

Visual/UX

Neutral grey panels everywhere; no brown tint.

Dates across the dashboard: Mon D, YYYY.

KPIs actionable (click ≡ deep link).

Google Map: custom colored pins + clustering + InfoWindow actions.

Action Feed has buttons that navigate to filtered pages.

Cashflow combo chart + Leasing funnel look polished and readable.

Occupancy by City right-aligned, with gold progress bars.

Data

Live data only—no mock imports.

KPI math verified from live sources:

Occupancy = occupiedUnits/totalUnits

Rent-Ready Vacant from Units status + readiness flag

Collections MTD = received / billed (month-to-date)

NOI MTD = income MTD − expenses MTD

Delinquency = tenant balance > 0 or past due

Hotlist WO priority in High/Critical or age > 7 days

Quality

Zero console errors.

All network calls abort on unmount.

LCP under reasonable threshold (charts lazy mount after data).

No regressions on Portfolio pages.

Deliverables to paste back:

Before/After screenshots (desktop and narrow widths).

File diff summary (paths changed/added).

Proof of no mock imports (search results).

?debug=1 snapshot with counts and metric values.

Commit message

feat(dashboard): Genesis-grade live dashboard — actionable KPIs, Google Map clustering, Priority Action Feed, Cashflow+NOI, Leasing funnel, neutral panels, global date format

Notes / Improvements You Must Include

Remove any duplicated financial logic in components; keep all math in the hooks.

Use tokens for chart colors: income = --good, expenses = --neutral, NOI = --altus-gold.

Empty states: never blank/black areas—always a helpful message and a link to the relevant page.

Keyboard & a11y: tab-focus outlines on KPI cards, feed buttons, and map InfoWindow actions.

Env keys required:

VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY (or current API base + token)

VITE_GOOGLE_MAPS_API_KEY (map). Show friendly inline message if missing.

Execute the phases in order, post the preflight audit first, then proceed in small, verifiable steps.