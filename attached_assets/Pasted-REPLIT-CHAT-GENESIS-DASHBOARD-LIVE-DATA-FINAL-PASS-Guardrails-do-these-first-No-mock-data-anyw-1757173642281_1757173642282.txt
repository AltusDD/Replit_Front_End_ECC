REPLIT CHAT ‚Äî GENESIS DASHBOARD: LIVE-DATA FINAL PASS
Guardrails (do these first)

No mock data anywhere. If a field is missing, show an explicit empty state and surface it in the QA overlay; do not synthesize or randomize.

One date format globally: Mon D, YYYY (e.g., Sep 9, 2025).

Genesis theme only: Altus Black background, Inter font, replace any brown tint with our approved cool neutrals (see token updates below).

Every metric is actionable: clicking a KPI or label deep-links to the correct pre-filtered Portfolio/Maintenance page.

AbortErrors must be swallowed during unmount; never log them as errors.

Google Maps only for the map; plot real lat/lng only‚Äîno fake jitter.

0) Packages / house-keeping
npm i @vis.gl/react-google-maps @googlemaps/markerclusterer recharts


Keep eruda out of the bundle. If still present in src/main.tsx, guard with:

if (import.meta.env.DEV && location.search.includes("eruda")) {
  import("eruda").then(m => m?.default?.init?.()).catch(() => void 0);
}

1) Theme tokens ‚Äî increase contrast, remove brown tint

File: src/styles/tokens.css
Replace surface/line neutrals with cool grays for contrast:

:root{
  --altus-black:#0b0e12;
  --altus-gold:#d6b36a;

  /* Surfaces (cool neutral) */
  --panel-bg:#171a1f;     /* cards */
  --panel-elev:#1c2026;   /* raised cards */
  --line:#2a2f36;         /* borders */

  --text:#e8eaf0;         /* primary */
  --text-dim:#a6adbb;     /* secondary */

  --good:#2cc38a;
  --warn:#f3c969;
  --bad:#ef5953;
  --neutral:#8b93a3;
}


File: src/styles/Dashboard.css

Panels: border:1px solid var(--line); border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.35)

KPI card: min-height: 96px; padding: 16px 18px; label 12px uppercase/0.06em; value 24px/600.

Skeleton shimmer class for loading.

2) Global formatters (dates/money/percent)

File: src/utils/format.ts

export const fmtDate = (iso?: string | null) =>
  !iso ? "‚Äî" :
  new Date(iso).toLocaleDateString(undefined, { month:"short", day:"numeric", year:"numeric" });

export const fmtMoney = (n?: number | null) => {
  if (n == null || Number.isNaN(n)) return "‚Äî";
  if (n === 0) return "$0";
  return n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:0});
};

export const fmtPct = (n?: number | null, dp=1) =>
  n==null || Number.isNaN(n) ? "‚Äî" : `${n.toFixed(dp)}%`;


Replace any local formatters in dashboard components with these.

3) Network helpers and error policy

File: src/utils/net.ts

export async function fetchJSON<T>(url: string, signal?: AbortSignal): Promise<T> {
  const res = await fetch(url, { signal, credentials:"include" });
  if (!res.ok) throw new Error(`${res.status} ${res.statusText} for ${url}`);
  return res.json() as Promise<T>;
}


Never throw/log on AbortError. Treat as normal unmount.

4) Live data hook (single source of truth, no synth)

File: src/features/dashboard/hooks/useDashboardData.ts

Implement useDashboardData() that fetches these live endpoints in parallel with AbortController:

/api/portfolio/properties ‚Üí { id, name, address, city, state, zip, lat, lng, active }

/api/portfolio/units ‚Üí { id, property_id, status, rent_amount, rent_ready }

/api/portfolio/leases ‚Üí { id, unit_id, property_id, status, start_date, end_date, rent_cents, tenant_ids?, primary_tenant_id? }

/api/portfolio/tenants ‚Üí { id, display_name|full_name, balance_cents, delinquency_days? }

/api/maintenance/workorders ‚Üí { id, property_id, priority, status, created_at, title }

/api/accounting/transactions?last=90d ‚Üí { type:"rent"|"expense", amount_cents, posted_on }

Derived (frontend only, no heavy computation):

Occupancy = occupied units / total rentable units.

Rent-ready / Vacant: count from units (status=vacant) and rent_ready.

Collections MTD = sum(receipts ‚Äúrent‚Äù this month) / sum(billed rent for active leases this month). Provide numerator/denominator in tooltip data.

NOI MTD = income ‚Äì expenses (exclude capex if flagged in payload).

Action feed:

Delinquents: top 3 tenants by balance_cents > 0, include delinquency_days if provided.

Renewals: leases expiring ‚â§ 45 days.

Hotlist: work orders priority ‚àà {High,Critical} OR age > 7 days.

QA overlay (dev only):
Return a qa object:

qa:{
  counts:{ properties:number, units:number, leases:number, tenants:number, workorders:number, tx:number },
  missing:{ geo:number, tenantName:number, workOrderPriority:number },
  lastUpdated:string
}


missing.geo = properties with no lat/lng (they are excluded from map).

Abort safety: cancel all fetches on unmount and ignore AbortError.

5) KPI Ticker ‚Äî clickable, legible, consistent

File: src/features/dashboard/components/KpiTicker.tsx

4 KPIs with donut/sparkline:

Occupancy (donut + vs last month) ‚Üí link /portfolio/units?status=occupied

Rent Ready / Vacant ‚Üí /portfolio/units?status=vacant&rent_ready=true

Collections MTD with small sparkline of daily receipts ‚Üí /accounting?range=mtd&type=rent

Critical Work Orders ‚Üí /maintenance?priority=high,critical&status=open

Use token colors; value 24px; secondary text var(--text-dim).

6) Portfolio Google Map ‚Äî clusters, real pins only

File: src/features/dashboard/components/PortfolioGoogleMap.tsx

Use @vis.gl/react-google-maps. Key from VITE_GOOGLE_MAPS_API_KEY.

Plot only properties with lat && lng. Show a gold ‚ÄúMissing geo: N‚Äù pill if any excluded; click opens a lightweight drawer listing affected properties (dev only when ?debug=1).

Pin status colors:

Green: occupied + current.

Yellow: vacant + rent-ready.

Orange: vacant + not rent-ready.

Red: occupied + delinquent tenant.

Cluster with MarkerClusterer (gold ring, dark fill).

InfoWindow: property name, address, status chip, and actions:

View Details ‚Üí /card/property/{id}

Open Work Orders ‚Üí /maintenance?property_id={id}&status=open

View Tenants ‚Üí /portfolio/tenants?property_id={id}

7) Priority Action Feed ‚Äî three real queues, clear CTAs

File: src/features/dashboard/components/PriorityActionFeed.tsx

Delinquency Alerts (Top 3): tenant, property, balance (red), days overdue; actions: Send Reminder, Start Eviction (deep links to Communication/Legal with query params).

Lease Renewals (‚â§45 days, Top 3): tenant, property, expires {fmtDate}; actions: Prepare Renewal, Do Not Renew.

Maintenance Hotlist (Top 3): property, priority, age in days; action: Assign Vendor.

Positive empty states (e.g., ‚ÄúNo delinquent tenants üéâ‚Äù).

8) Financials & Leasing ‚Äî cashflow+NOI and conversion

File: src/features/dashboard/components/FinancialsAndLeasing.tsx

Cash Flow (90d): ComposedChart

Income (green bars), Expenses (neutral bars), NOI (Altus Gold line).

Tooltip shows all three and variance vs prev period.

Leasing Funnel (30d): Leads ‚Üí Tours ‚Üí Applications ‚Üí Approved ‚Üí Signed with stage conversion %.

CTA buttons: View Vacants (/portfolio/units?status=vacant) and View Applications (/leases?status=pending).

Range controls (30/60/90) with Altus Gold underline for active.

9) Occupancy by City ‚Äî readable and drillable

File: src/features/dashboard/components/OccupancyByCity.tsx

Columns: City, #Props, Occupied Units, Vacant Units, Occupancy %.

Right-align numerics; gold progress bar for %; sortable headers; default to Top 10 with ‚ÄúShow all‚Äù.

Row click ‚Üí /portfolio/properties?city={city}.

10) Page layout & skeletons

File: src/features/dashboard/pages/DashboardPage.tsx

Grid:

Row 1: KPI Ticker (full).

Row 2: Map (2/3) + Action Feed (1/3).

Row 3: Financials (1/2) + Leasing (1/2).

Row 4: Occupancy by City (full).

Show panel skeletons while loading; no layout shift.

QA overlay (dev only) when ?debug=1: right-side drawer showing qa counts/missing and ‚ÄúCopy report‚Äù button.

11) Deep links (must work)

KPI clicks and feed buttons must route with query params to the relevant page and filter state (Portfolio V3, Maintenance, Accounting).

Chart legends toggle series visibility.

12) Acceptance checklist (block merge until all pass)

No mock data (grep for mock, Math.random, hardcoded arrays).

Zero console errors/warnings in dev; AbortErrors swallowed.

All dates read Mon D, YYYY.

KPI clickthroughs hit correct filters.

Map renders with only real lat/lng; QA pill appears iff any missing; count matches.

Collections MTD = receipts/billed (numerator/denominator in tooltip).

NOI line = income ‚Äì expenses per period.

Leasing funnel counts match Portfolio pages for same range.

Contrast AA verified on labels/values.

Responsive: desktop/tablet/mobile‚Äîno overflow/clipping.

Commit message

feat(dashboard): Genesis-grade live-data upgrade ‚Äî contrast tokens, global date format, actionable KPIs, clustered Google Map, priority action feed, cashflow+NOI, leasing funnel, occupancy table, QA overlay


Return to me with:

Desktop & mobile screenshots,

QA overlay JSON (when ?debug=1),

Short file diff summary.

If you run into any field mismatches from the API, do not patch with placeholders‚Äîsurface them in qa.missing and show a visible (but non-blocking) empty state in the affected widget.