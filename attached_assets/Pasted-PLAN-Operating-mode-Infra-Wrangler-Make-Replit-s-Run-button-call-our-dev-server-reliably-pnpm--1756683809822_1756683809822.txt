PLAN

Operating mode: Infra Wrangler. Make Replit’s Run button call our dev server reliably (pnpm + Vite). Remove conflicts that can confuse Replit.

Files to touch:

.replit

replit.nix (confirm)

package.json (scripts only, confirm)

vite.config.mjs (confirm, delete vite.config.js if present)

Rollback: restore the .bak files created in BACKUP.

BACKUP
cp -f .replit .replit.bak 2>/dev/null || true
cp -f replit.nix replit.nix.bak 2>/dev/null || true
cp -f package.json package.json.bak 2>/dev/null || true
cp -f vite.config.js vite.config.js.bak 2>/dev/null || true
cp -f vite.config.mjs vite.config.mjs.bak 2>/dev/null || true

CHANGESET
1) Ensure the file is named .replit (with a dot)

If you see a file named replit (no dot), rename it — Replit ignores it.

[ -f replit ] && mv -f replit .replit || true

2) Overwrite .replit with this exact content
# .replit
# Make the big Run button start our dev server via pnpm.
run = "pnpm dev"

# Ensure Replit uses pnpm for installs.
[packager]
install = "pnpm install"

# Optional: keep noise out of the sidebar.
hidden = [".cache", ".vite", "dist", "node_modules"]

3) Confirm replit.nix has Node 18 + pnpm (leave as-is if it matches)
{ pkgs }: {
  deps = [
    pkgs.nodejs_18
    pkgs.nodePackages.pnpm
  ];
}

4) Confirm package.json scripts (dev/build/preview)
{
  "scripts": {
    "dev": "vite --host --port 5000",
    "build": "vite build",
    "preview": "vite preview --host 0.0.0.0 --port 5000"
  }
}

5) Use one Vite config (MJS). Delete the JS one.
rm -f vite.config.js

6) Ensure vite.config.mjs allows Replit host + fixes “blocked host”

Overwrite with this (safe default):

// vite.config.mjs
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

export default defineConfig({
  plugins: [react()],
  server: {
    host: true,
    port: 5000,
    strictPort: true,
    allowedHosts: true, // allow Replit's dynamic worf host
    hmr: { clientPort: 443 } // stable HMR in Replit preview
  },
  preview: {
    host: true,
    port: 5000,
    strictPort: true,
    allowedHosts: true
  }
});

CLEAN START (fix “port already in use” + start)
pkill -f vite || true
rm -rf .vite dist
pnpm install
pnpm dev


If the big Run button still says “Agent hasn’t configured Run button yet,” refresh the Replit tab after saving .replit. That message comes from Replit not detecting a valid .replit file at the project root — the rename to .replit fixes it.

WHY THIS WORKS (quick)

Replit’s Run button only looks for a root .replit file. If it’s missing or misnamed (replit without the dot), Run won’t wire up.

Setting run = "pnpm dev" makes the big button do exactly what we’d run in the shell.

replit.nix gives us node + pnpm in PATH (npm is optional since we standardized on pnpm).

Killing Vite frees port 5000 so the next run succeeds.

Removing the duplicate vite.config.js prevents config ambiguity.

allowedHosts: true fixes the earlier Replit “host not allowed” error.

Ping me if anything in the UI still doesn’t respond after this; we’ll look at the console output together and address whatever Replit shows.